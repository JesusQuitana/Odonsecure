let total=0;function iniciarApp(){allCitas(),foundCita()}async function allCitas(){const e=`${location.origin}/admin/all`,t=await fetch(e),n=await t.json(),a=new Map;n.forEach((e=>{const{id:t,cliente:n,email:o,fecha:i,hora:r,precio:c,servicio:l,telefono:s}=e;a.has(t)?(a.get(t).total+=parseFloat(c),a.get(t).servicios.push(l)):a.set(t,{id:t,fecha:i,hora:r,cliente:n,email:o,total:parseFloat(c),servicios:[l]})})),a.forEach((e=>{mostrarCita(e)}))}function foundCita(){const e=document.querySelector("#date"),t=document.querySelector("#user");e.addEventListener("input",(e=>{const n=document.querySelectorAll(".cita");null!==n&&n.forEach((e=>{e.remove()})),consultarCita(e.target.value,t.value)})),t.addEventListener("input",(t=>{const n=document.querySelectorAll(".cita");null!==n&&n.forEach((e=>{e.remove()})),consultarCita(e.value,t.target.value)}))}async function consultarCita(e,t){const n=`${location.origin}/admin/find`,a=new FormData;a.append("fecha",e),a.append("user",t);const o=await fetch(n,{method:"POST",body:a}),i=await o.json(),r=new Map;i.forEach((e=>{const{id:t,cliente:n,email:a,fecha:o,hora:i,precio:c,servicio:l,telefono:s}=e;r.has(t)?r.get(t).servicios.push(l):r.set(t,{id:t,fecha:o,hora:i,cliente:n,email:a,servicios:[l]})})),r.forEach((e=>{mostrarCita(e)}))}function mostrarCita(e){const t=document.querySelector(".citasBody"),{id:n,cliente:a,fecha:o,hora:i,servicios:r,email:c,total:l}=e,s=document.createElement("DIV");s.classList.add("cita");const d=document.createElement("P");d.innerHTML=`<span>Nro Cita:</span> 000${n}`;const h=document.createElement("P");h.innerHTML=`<span>Paciente:</span> ${a}`;const p=document.createElement("P");p.innerHTML=`<span>Fecha:</span> ${o}`;const u=document.createElement("P");u.innerHTML=`<span>Hora:</span> ${i}`;const m=document.createElement("P");m.innerHTML=`<span>Total:</span> ${l}<span class="verde">$</span>`;const f=document.createElement("P");f.setAttribute("style","display: none"),r.forEach((e=>{f.innerHTML+=`${e}<br>`})),s.appendChild(d),s.appendChild(h),s.appendChild(p),s.appendChild(u),s.appendChild(m),s.appendChild(f),t.appendChild(s),s.addEventListener("click",(t=>{Swal.fire({showCloseButton:!0,title:"<strong>Servicios</strong>",icon:"info",focusConfirm:!1,html:`\n              ${f.innerHTML}\n            `,confirmButtonText:'<svg  xmlns="http://www.w3.org/2000/svg"  width="18"  height="18"  viewBox="0 0 24 24"  fill="none"  stroke="currentColor"  stroke-width="2"  stroke-linecap="round"  stroke-linejoin="round"  class="icon icon-tabler icons-tabler-outline icon-tabler-file-type-pdf"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M14 3v4a1 1 0 0 0 1 1h4" /><path d="M5 12v-7a2 2 0 0 1 2 -2h7l5 5v4" /><path d="M5 18h1.5a1.5 1.5 0 0 0 0 -3h-1.5v6" /><path d="M17 18h2" /><path d="M20 15h-3v6" /><path d="M11 15v6h1a2 2 0 0 0 2 -2v-2a2 2 0 0 0 -2 -2h-1z" /></svg>',confirmButtonColor:"#1cb435",showDenyButton:!0,denyButtonText:'<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-trash" width="18" height="18" viewBox="0 0 24 24" stroke-width="2" stroke="#fff" fill="none" stroke-linecap="round" stroke-linejoin="round">\n            <path stroke="none" d="M0 0h24v24H0z" fill="none"/>\n            <path d="M4 7l16 0" />\n            <path d="M10 11l0 6" />\n            <path d="M14 11l0 6" />\n            <path d="M5 7l1 12a2 2 0 0 0 2 2h8a2 2 0 0 0 2 -2l1 -12" />\n            <path d="M9 7v-3a1 1 0 0 1 1 -1h4a1 1 0 0 1 1 1v3" />\n            </svg>'}).then((t=>{t.isConfirmed?enviarResumen(e):t.isDenied&&eliminarCita(e)}))}))}async function enviarResumen(e){const{id:t,cliente:n,fecha:a,hora:o,servicios:i,email:r,total:c}=e,l=new FormData;l.append("id",t),l.append("cliente",n),l.append("fecha",a),l.append("hora",o),l.append("servicios",i),l.append("email",r),l.append("total",c);const s=`${location.origin}/admin/resumen`,d=await fetch(s,{method:"POST",body:l});await d.json()?Swal.fire({position:"center",icon:"success",title:"Tu cita ha sido enviada a tu correo",confirmButtonText:"Ok"}).then((()=>{window.location.reload()})):Swal.fire({icon:"error",title:"Oops...",text:"Ocurrio un error al enviar su PDF!"}).then((()=>{window.location.reload()}))}async function eliminarCita(e){const{id:t,cliente:n,fecha:a,hora:o,servicios:i,email:r,total:c}=e,l=`${location.origin}/admin/delete`;(e=new FormData).append("id",t);const s=await fetch(l,{method:"POST",body:e});(await s.json()).resultado?Swal.fire({position:"center",icon:"success",title:"La cita ha sido eliminada",confirmButtonText:"Ok"}).then((()=>{window.location.reload()})):Swal.fire({icon:"error",title:"Oops...",text:"Ocurrio un error al eliminar la cita!"}).then((()=>{window.location.reload()}))}document.addEventListener("DOMContentLoaded",(function(){iniciarApp()}));