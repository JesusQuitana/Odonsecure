let paso=1;const pasoInicial=1,pasoFinal=3,cita={nombre:"",fecha:"",hora:"",servicios:[]};function initApp(){getServicios(),getNombre(),fechasDisponibles(),horasDisponibles(),tabs(),botonesPaginador()}function alerta(e,t){if(document.querySelector(".alerta"))return;const o=document.createElement("P");o.classList.add("alerta"),o.classList.add(e),o.innerHTML=t,document.querySelector(".alertas").appendChild(o),setTimeout((()=>{o.remove()}),2e3)}function getCita(){Object.values(cita).includes("")?alerta("rojo","Debe agregar datos para generar la cita"):createResumen()}function createResumen(){const e=document.querySelector(".resumen"),t=document.querySelector(".botonAgendar"),{nombre:o,fecha:a,hora:n,servicios:r}=cita;let c=0;const i=new Date(a),s=i.getFullYear(),l=i.getMonth(),d=i.getDate()+2,u=new Date(Date.UTC(s,l,d)).toLocaleDateString("es-CO",{weekday:"long",year:"numeric",month:"long",day:"numeric"});r.forEach((e=>{c+=parseFloat(e.precio)}));const p=document.querySelector(".nombreCliente");p.innerHTML=`<span>Nombre:</span> ${o}`;const m=document.querySelector(".fechaCita");m.innerHTML=`<span>Dia:</span> ${u}`;const v=document.querySelector(".horaCita");v.innerHTML=`<span>Hora:</span> ${n} horas`;const h=document.querySelector(".nombreServicios");h.innerHTML="<span>Servicios:</span> ",r.forEach((e=>{h.innerHTML+=`${e.nombre}, `}));const S=document.querySelector(".total");S.innerHTML=`<span>Total:</span> ${c}<span class='precio'>$</span>`;document.querySelector(".button_agendar").setAttribute("style","display: inline-block"),t.addEventListener("click",(()=>{enviarCita()})),null!==e&&(e.appendChild(p),e.appendChild(m),e.appendChild(v),e.appendChild(h),e.appendChild(S))}async function enviarCita(){const{nombre:e,fecha:t,hora:o,servicios:a}=cita,n=a.map((e=>e.id)),r=new FormData;r.append("nombre",e),r.append("fecha",t),r.append("hora",o),r.append("servicios",n);try{const e=`${location.origin}/resumen`,t=await fetch(e,{method:"POST",body:r});!0===(await t.json()).resultado?Swal.fire({position:"center",icon:"success",title:"Tu cita ha sido agendada, estaremos enviado por correo el resumen",confirmButtonText:"Ok"}).then((e=>{window.location.reload()})):Swal.fire({icon:"error",title:"Oops...",text:"Ocurrio un error al registrar su cita!"}).then((e=>{window.location.reload()}))}catch(e){console.log(respuesta),Swal.fire({icon:"error",title:"Oops...",text:"Ocurrio un error al registrar su cita!"}).then((()=>{window.location.reload()}))}}async function getServicios(){try{const e=`${location.origin}/user/api`,t=await fetch(e);mostrarServicios(await t.json())}catch(e){console.log(e)}}function mostrarServicios(e){e.forEach((e=>{const{id:t,nombre:o,precio:a}=e,n=document.querySelector(".servicios"),r=document.createElement("DIV"),c=document.createElement("P"),i=document.createElement("P"),s=document.createElement("P");r.classList.add("servicio"),c.innerHTML=o,i.innerHTML=`${a}<span>$</span>`,s.innerHTML="Haz click para seleccionar",r.appendChild(c),r.appendChild(i),r.appendChild(s),n.appendChild(r),r.addEventListener("click",(()=>{seleccionarServicio(e,r)}))}))}function seleccionarServicio(e,t){const{servicios:o}=cita;o.some((t=>t.id===e.id))?(cita.servicios=o.filter((t=>t.id!==e.id)),t.classList.remove("seleccionado")):(cita.servicios=[...o,e],t.classList.add("seleccionado"))}function getNombre(){const e=document.querySelector("#nombre");cita.nombre=e.value}function fechasDisponibles(){document.querySelector("#date").addEventListener("input",(e=>{const t=new Date(e.target.value).getUTCDay();[6,0].includes(t)?(e.target.value="",alerta("rojo","Fines de Semana no Disponible")):cita.fecha=e.target.value}))}function horasDisponibles(){document.querySelector("#time").addEventListener("input",(e=>{const t=e.target.value.split(":")[0];t<8||t>17?(e.target.value="",alerta("rojo","Horario Comprendido entre las 08:00am y las 05:00pm")):cita.hora=e.target.value}))}function seleccionarSeccion(){const e=document.querySelector(`#paso${paso}`),t=document.querySelector(".mostrar"),o=document.querySelector(`#tab${paso}`),a=document.querySelector(".seleccionado");t!==e&&a!==o&&(mostrarBotones(),e.classList.add("mostrar"),t.classList.remove("mostrar"),o.classList.add("seleccionado"),a.classList.remove("seleccionado"))}function tabs(){document.querySelectorAll(".paginador button").forEach((e=>{e.addEventListener("click",(e=>{paso=parseInt(e.target.dataset.paso),seleccionarSeccion()}))}))}function botonesPaginador(){const e=document.querySelector("#anterior"),t=document.querySelector("#siguiente");e.addEventListener("click",(e=>{t.classList.remove("ocultar_btn"),paso<=pasoInicial||(paso-=1,seleccionarSeccion())})),t.addEventListener("click",(t=>{e.classList.remove("ocultar_btn"),paso>=pasoFinal||(paso+=1,seleccionarSeccion())}))}function mostrarBotones(){const e=document.querySelector("#anterior"),t=document.querySelector("#siguiente");paso===pasoInicial?(e.classList.add("ocultar_btn"),t.classList.remove("ocultar_btn")):paso===pasoFinal?(t.classList.add("ocultar_btn"),e.classList.remove("ocultar_btn"),getCita()):(e.classList.remove("ocultar_btn"),t.classList.remove("ocultar_btn"))}document.addEventListener("DOMContentLoaded",(function(){initApp()}));